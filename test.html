<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .base64-data { background: #f0f0f0; padding: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>UI 改进快速测试</h1>
    
    <div class="test-section">
        <h3>1. SHA256 哈希测试 (Base64格式)</h3>
        <p>测试数据: "Hello World"</p>
        <p>SHA256 十六进制: <span id="hash-hex">计算中...</span></p>
        <p>SHA256 Base64: <span id="hash-base64">计算中...</span></p>
        <button onclick="testSHA256()">测试 SHA256</button>
    </div>
    
    <div class="test-section">
        <h3>2. 浮动验证窗口测试</h3>
        <p>鼠标悬停在这个哈希值上1秒: 
        <span class="base64-data" data-type="hash" data-full-value="pmWkWSBCL51BfkhufvxPuKBKHz//H6B+mY6G9/eieuo=">pmWkWSBCL51BfkhufvxPuKBKHz//H6B+mY6G9/eieuo=</span></p>
    </div>
    
    <div class="test-section">
        <h3>3. 复制功能测试</h3>
        <button onclick="testCopy()">测试复制功能</button>
        <div id="copy-result"></div>
    </div>

    <div class="test-section">
        <h3>4. MainPanel 类测试</h3>
        <button onclick="testMainPanel()">测试 MainPanel</button>
        <div id="mainpanel-result"></div>
    </div>

    <script src="src/services/Crypto.js"></script>
    <script src="src/ui/CtrlPanel.js"></script>
    <script src="src/ui/MainPanel.js"></script>
    <script>
        // 测试 SHA256
        async function testSHA256() {
            try {
                const hexHash = await Crypto.sha256("Hello World");
                // 将十六进制哈希转换为base64格式
                const hashBytes = new Uint8Array(hexHash.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
                const base64Hash = btoa(String.fromCharCode.apply(null, hashBytes));
                
                document.getElementById('hash-hex').innerHTML = `<span class="success">${hexHash}</span>`;
                document.getElementById('hash-base64').innerHTML = `<span class="success">${base64Hash}</span>`;
                console.log('SHA256 测试成功 - 十六进制:', hexHash);
                console.log('SHA256 测试成功 - Base64:', base64Hash);
            } catch (error) {
                document.getElementById('hash-hex').innerHTML = `<span class="error">错误: ${error.message}</span>`;
                document.getElementById('hash-base64').innerHTML = `<span class="error">错误: ${error.message}</span>`;
                console.error('SHA256 测试失败:', error);
            }
        }
        
        // 测试 MainPanel
        function testMainPanel() {
            try {
                const mockUIManager = { app: {} };
                const mainPanel = new MainPanel(mockUIManager);
                console.log('MainPanel 创建成功:', mainPanel);
                document.getElementById('mainpanel-result').innerHTML = '<span class="success">MainPanel 类创建成功！</span>';
                return true;
            } catch (error) {
                console.error('MainPanel 创建失败:', error);
                document.getElementById('mainpanel-result').innerHTML = `<span class="error">MainPanel 创建失败: ${error.message}</span>`;
                return false;
            }
        }
        
        // 测试复制功能
        function testCopy() {
            const mockUIManager = { app: {} };
            const ctrlPanel = new CtrlPanel(mockUIManager);
            
            ctrlPanel.copyTextToClipboard('这是测试复制的内容', '复制测试成功！');
            document.getElementById('copy-result').innerHTML = '<span class="success">复制功能已触发，请检查剪贴板</span>';
        }
        
        // 设置浮动验证窗口
        document.addEventListener('DOMContentLoaded', function() {
            const mockUIManager = { app: { currentConfig: { chainDefinition: 'test data' } } };
            const ctrlPanel = new CtrlPanel(mockUIManager);
            ctrlPanel.setupHashHoverEvents();
            
            // 自动测试 SHA256
            testSHA256();
        });
    </script>
</body>
</html>