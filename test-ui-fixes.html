<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI修复测试</title>
    <link rel="stylesheet" href="src/styles/main.css">
</head>
<body>
    <div id="app">
        <header class="app-header">
            <h1>UI修复测试页面</h1>
        </header>

        <main class="app-main">
            <!-- 控制面板 -->
            <section id="control-panel" class="panel control-panel">
                <h2>控制面板</h2>
                <div class="panel-content">
                    <button onclick="testNetworkGraph()">测试网络图</button>
                    <button onclick="testUserUpdate()">测试用户更新</button>
                    <button onclick="testLogAdd()">添加测试日志</button>
                </div>
            </section>

            <!-- 主面板 -->
            <section id="main-panel" class="panel main-panel">
                <div class="panel-content">
                    <!-- 主面板内容 -->
                </div>
            </section>

            <!-- 日志面板 -->
            <section id="log-panel" class="panel log-panel">
                <h2>操作日志</h2>
                <div class="panel-content">
                    <!-- 日志面板内容 -->
                </div>
            </section>
        </main>
    </div>

    <!-- D3.js for network visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- 加载修复后的组件 -->
    <script src="src/ui/MainPanel.js"></script>
    <script src="src/ui/LogPanel.js"></script>
    <script src="src/ui/UIManager.js"></script>

    <script>
        // 创建测试应用
        const testApp = {
            getMainPanelData: () => ({
                networkData: {
                    totalUsers: 8,
                    totalConnections: 12,
                    activeConnections: 10,
                    maxConnections: 3,
                    failureRate: 0.1
                },
                userData: new Map([
                    ['User1', { totalAssets: 100, isTransferring: false }],
                    ['User2', { totalAssets: 250, isTransferring: true }],
                    ['User3', { totalAssets: 75, isTransferring: false }],
                    ['User4', { totalAssets: 180, isTransferring: false }]
                ]),
                chainData: new Map([
                    ['Chain1', { value: 50, isTransferring: false }],
                    ['Chain2', { value: 100, isTransferring: true }],
                    ['Chain3', { value: 25, isTransferring: false }]
                ])
            })
        };

        // 初始化UI管理器
        const uiManager = new UIManager(testApp);
        uiManager.initUI();

        // 测试函数
        function testNetworkGraph() {
            const data = testApp.getMainPanelData();
            uiManager.panels.main.updateAllData(data);
        }

        function testUserUpdate() {
            // 模拟用户数据变化
            const data = testApp.getMainPanelData();
            data.userData.set('User2', { totalAssets: 300, isTransferring: false });
            data.userData.set('User5', { totalAssets: 120, isTransferring: true });
            uiManager.panels.main.updateAllData(data);
        }

        function testLogAdd() {
            const logTypes = ['block', 'network', 'security', 'warning'];
            const messages = [
                '区块添加成功',
                '网络连接建立',
                '检测到双花攻击',
                '连接超时警告'
            ];
            
            const randomType = logTypes[Math.floor(Math.random() * logTypes.length)];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            uiManager.panels.log.addLog(randomType, randomMessage);
        }

        // 自动测试
        setTimeout(() => {
            testNetworkGraph();
            
            // 每2秒添加一条日志
            setInterval(testLogAdd, 2000);
            
            // 每5秒更新用户数据
            setInterval(testUserUpdate, 5000);
        }, 1000);
    </script>
</body>
</html>